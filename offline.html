<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet"
        crossorigin="anonymous"> -->
    <link href="style.css" rel="stylesheet">
    <!-- <link href="off/bootstrap.bundle.min.js" rel="stylesheet"> -->
    <link href="off/bootstrap.min.css" rel="stylesheet">
    <title>Resultados Encontrados</title>
</head>

<body>
    <header
        class="d-flex flex-wrap align-items-center justify-content-center justify-content-md-between py-3 mb-4 border-bottom">
        <a href="/" class="d-flex align-items-center col-md-3 mb-2 mb-md-0 text-dark text-decoration-none">
            <img src="./imgs/logo.png" class="logo" alt="logo" width="700" height="100">
        </a>
    </header>

    <section class="container" style="margin-top: 100px;">
        <div class="row">
            <div class="col-12">
                <div class="alert alert-warning" role="alert">
                    <img src="off/offline.png" width="30">
                    Você está acessando esse site offline. Veja os últimos serviços visitados.
                  </div>
            </div>
        </div>
    </section>

    <main class="container" id="content" style="margin-top: 10px;">            
    </main>

    <script src="off/bootstrap.bundle.min.js"></script>
    <script>

//Carregamento AJAX
let ajax = new XMLHttpRequest();

ajax.open("GET", "off/dadosOffline.json", true);

ajax.send();

//Monitorar o retorno requisição
ajax.onreadystatechange = function()
{
    //Especificar o container que recebe o conteudo gerado neste arquivo
    let content = document.getElementById("content");

    if (this.readyState == 4 && this.status == 200) {
    
     let data_json = JSON.parse(ajax.responseText);

     if(data_json.length == 0){

        content.innerHTML = '<div class="alert alert-warning" role="alert">Desculpe. Ainda não temos serviços cadastrados!</div>';
     
    }else{
        
        let html_content = "";

        for(let i = 0; i<data_json.length; i++)
        {
        
            html_content +='<div class="row"><div class="col-12"><h2><span> </span> '+data_json[i].categoria+'</h2></div></div>';

            if (data_json[i].servicos.length == 0)
            {
                html_content += '<div class="row"><div class="col-12"><div class="alert alert-warning" role="alert">Desculpe. Não temos serviços para esta categoria.</div></div></div>';
            }
            else
            {
                html_content += '<div class="row">';

                for(let j = 0; j<data_json[i].servicos.length; j++)
                {                        
                    html_content += card_resultado(data_json[i].servicos[j].nome,data_json[i].servicos[j].imagem,data_json[i].servicos[j].valor,data_json[i].servicos[j].whatsapp);
                }

                html_content += '</div>';                                    
            }

        }

        content.innerHTML = html_content;        
    }

    }
}

var card_resultado = function(nome, imagem, valor, endereco)
{
    return '<div class="col-lg-6">'+
                '<div class="card">'+
                    '<img src="'+imagem+'" class="card-img-top" alt="'+nome+'">'+
                    '<div class="card-body">'+
                        '<h5 class="card-title">'+nome+'</h5>'+
                        '<h6 card-subtitle mb-2 text-muted>'+endereco+'</h6>'+
                        '<p class="card-text"><strong>Valor Médio:</strong> '+valor+'</p>'+
                    '</div>'+
                '</div>'+
            '</div>';
}

    </script>
  </body>        
</html>